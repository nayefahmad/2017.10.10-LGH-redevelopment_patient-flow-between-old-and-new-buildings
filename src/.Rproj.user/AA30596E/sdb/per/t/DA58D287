{
    "collab_server" : "",
    "contents" : "\n\n#****************************************\n# Analysis of LOS data for 4E, 6E, 6W\n#****************************************\n\nlibrary(\"ggplot2\")\nlibrary(\"dplyr\")\n\n# rm(list=ls())\n\n\n# Todo: -------------------\n# > why 58 NAs for 4E data? \n# > get arrival timestamps for 4W, 6E, 6W \n# ******************************\n\n\n# ****************************** \n# pull in clean data: \nsource(\"2017-10-06_Example-data-cleaning.R\")\n# str(losdata)\n\n# pull in function to calculate LOS, extract arrival timestamps: \nsource(\"los_function.R\")\nsource(\"arrival-timestamp_function.R\")\n\n\n# ******************************\n\n\n# ******************************\n# Analysis for 4E ---------------\n# ******************************\n\n# > LOS calculation: --------------\n# split data by unique encounter: \nsplit.losdata.4e <- split(losdata.4e, losdata.4e$id)\n# str(split.losdata)\n\n# apply los.fn, then combine results into a vector: \nlos.4e <- \n      lapply(split.losdata.4e, los.fn, \n                 nursingunit = \"4E\")  %>%  # nursingunit is passed to los.fn\n      unlist %>% unname \nstr(los.4e)\nsummary(los.4e)\n\n\nlos.4e.df <- as.data.frame(los.4e)  # easier to work with in ggplot \nstr(los.4e.df)\n\n# tables of results: \nsummary.4e <- \n      summarise(los.4e.df,\n          unit=\"4E\", \n          mean=mean(los.4e, na.rm=TRUE), \n          median=quantile(los.4e, probs = .50, na.rm=TRUE), \n          x90th.perc=quantile(los.4e, probs = .90, na.rm=TRUE))\n\ntable.4e <- table(los.4e) %>% as.data.frame\n\n\n# > Extract arrival timestamps: ------------\narrivals.4e <- lapply(split.losdata.4e, arrival.fn, \n                      nursingunit = \"4E\")\narrivals.4e <- do.call(\"c\", arrivals.4e) %>% unname\n\nstr(arrivals.4e)\nsummary(arrivals.4e)\n\n\n# ******************************\n# Analysis for 4W ---------------\n# ******************************\n\n# split data by unique encounter: \nsplit.losdata.4w <- split(losdata.4w, losdata.4w$id)\n\n# apply los.fn, then combine results into a vector: \nlos.4w <- \n      lapply(split.losdata.4w, los.fn, \n             nursingunit = \"4W\")  %>%  # nursingunit is passed to los.fn\n      unlist %>% unname \nstr(los.4w)\nsummary(los.4w)\n\n\nlos.4w.df <- as.data.frame(los.4w)  # easier to work with in ggplot \nstr(los.4w.df)\n\n# tables of results: \nsummary.4w <- \n      summarise(los.4w.df,\n                unit=\"4W\", \n                mean=mean(los.4w, na.rm=TRUE), \n                median=quantile(los.4w, probs = .50, na.rm=TRUE), \n                x90th.perc=quantile(los.4w, probs = .90, na.rm=TRUE))\n\ntable.4w <- table(los.4w) %>% as.data.frame\n\n\n# ******************************\n# Analysis for 6E ---------------\n# ******************************\n\n# split data by unique encounter: \nsplit.losdata.6e <- split(losdata.6e, losdata.6e$id)\n# str(split.losdata)\n\n# apply los.fn, then combine results into a vector: \nlos.6e <- \n      lapply(split.losdata.6e, los.fn, \n             nursingunit = \"6E\")  %>% \n      unlist %>% unname \nstr(los.6e)\nsummary(los.6e)\n\n\nlos.6e.df <- as.data.frame(los.6e)  # easier to work with in ggplot \nstr(los.6e.df)\n\n# tables of results: \nsummary.6e <- \n      summarise(los.6e.df,\n                unit=\"6E\", \n                mean=mean(los.6e, na.rm=TRUE), \n                median=quantile(los.6e, probs = .50, na.rm=TRUE), \n                x90th.perc=quantile(los.6e, probs = .90, na.rm=TRUE))\n\ntable.6e <- table(los.6e) %>% as.data.frame\n# note: id=6660898079-17064865 has LOS = -1 because discharge date = 2017-05-29\n#     and transfer date = 2017-05-30. Not sure why that would happen. \n\n\n\n# ******************************\n# Analysis for 6W ---------------\n# ******************************\n\n# split data by unique encounter: \nsplit.losdata.6w <- split(losdata.6w, losdata.6w$id)\n# str(split.losdata.6w)\n\n# apply los.fn, then combine results into a vector: \nlos.6w <- \n      lapply(split.losdata.6w, los.fn, \n             nursingunit = \"6W\")  %>% \n      unlist %>% unname \nstr(los.6w)\nsummary(los.6w)\n\n\nlos.6w.df <- as.data.frame(los.6w)  # easier to work with in ggplot \nstr(los.6w.df)\n\n# tables of results: \nsummary.6w <- \n      summarise(los.6w.df,\n                unit=\"6W\", \n                mean=mean(los.6w, na.rm=TRUE), \n                median=quantile(los.6w, probs = .50, na.rm=TRUE), \n                x90th.perc=quantile(los.6w, probs = .90, na.rm=TRUE))\n\ntable.6w <- table(los.6w) %>% as.data.frame\n\n\n\n# ******************************\n# Plotting with ggplot: ------------\n# ******************************\n\n# > Graph for 4E --------\np1_hist.4e <- \n      ggplot(los.4e.df, \n             aes(x=los.4e)) + \n      geom_histogram(stat=\"bin\", \n                     binwidth = 1, \n                     col=\"black\", \n                     fill=\"deepskyblue\") + \n      \n      scale_x_continuous(limits=c(-1,85), \n                         breaks=seq(0,85,5), \n                         expand=c(0,0)) + \n      scale_y_continuous(expand=c(0,0)) + \n      \n      labs(x=\"LOS in days\", \n           y=\"Number of cases\", \n           title=\"Distribution of LOS in LGH 4E\", \n           subtitle=\"From 2014-04-01 onwards \\nMedian = 4.9 days; Mean = 11.1 days; \", \n           caption= \"\\nData source: DSDW ADTCMart; extraction date: 2017-10-10 \") + \n      \n      geom_vline(xintercept = summary.4e[,2], \n                 col=\"red\") + \n      \n      geom_vline(xintercept = summary.4e[,3], \n                 col=\"red\", \n                 linetype=2) + \n      \n      theme_classic(base_size = 16); p1_hist.4e\n\n\n# > Graph for 4W --------\np2_hist.4w <- \n      ggplot(los.4w.df, \n             aes(x=los.4w)) + \n      geom_histogram(stat=\"bin\", \n                     binwidth = 1, \n                     col=\"black\", \n                     fill=\"deepskyblue\") + \n      \n      scale_x_continuous(limits=c(-1,85), \n                         breaks=seq(0,85,5), \n                         expand=c(0,0)) + \n      scale_y_continuous(limits=c(0,200), \n                         expand=c(0,0)) + \n      \n      labs(x=\"LOS in days\", \n           y=\"Number of cases\", \n           title=\"Distribution of LOS in LGH 4W\", \n           subtitle=\"From 2014-04-01 onwards \\nMedian = 18.8 days; Mean = 25.4 days; \", \n           caption= \"\\nData source: DSDW ADTCMart; extraction date: 2017-10-11 \") + \n      \n      geom_vline(xintercept = summary.4w[,2], \n                 col=\"red\") + \n      \n      geom_vline(xintercept = summary.4w[,3], \n                 col=\"red\", \n                 linetype=2) + \n      \n      theme_classic(base_size = 16); p2_hist.4w\n\n\n# > Graph for 6E --------\np3_hist.6e <- \n      ggplot(los.6e.df, \n             aes(x=los.6e)) + \n      geom_histogram(stat=\"bin\", \n                     binwidth = 1, \n                     col=\"black\", \n                     fill=\"deepskyblue\") + \n      \n      scale_x_continuous(limits=c(-1,85), \n                         breaks=seq(0,85,5), \n                         expand=c(0,0)) + \n      scale_y_continuous(expand=c(0,0)) + \n      \n      labs(x=\"LOS in days\", \n           y=\"Number of cases\", \n           title=\"Distribution of LOS in LGH 6E\", \n           subtitle=\"From 2014-04-01 onwards \\nMedian = 2.9 days; Mean = 6.7 days; \", \n           caption= \"\\nData source: DSDW ADTCMart; extraction date: 2017-10-10 \") + \n      \n      geom_vline(xintercept = summary.6e[,2], \n                 col=\"red\") + \n      \n      geom_vline(xintercept = summary.6e[,3], \n                 col=\"red\", \n                 linetype=2) + \n      \n      theme_classic(base_size = 16); p3_hist.6e\n\n\n# > Graph for 6W: --------------\np4_hist.6w <- \n      ggplot(los.6w.df, \n             aes(x=los.6w)) + \n      geom_histogram(stat=\"bin\", \n                     binwidth = 1, \n                     col=\"black\", \n                     fill=\"deepskyblue\") + \n      \n      scale_x_continuous(limits=c(-1,85), \n                         breaks=seq(0,85,5), \n                         expand=c(0,0)) + \n      scale_y_continuous(expand=c(0,0)) + \n      \n      labs(x=\"LOS in days\", \n           y=\"Number of cases\", \n           title=\"Distribution of LOS in LGH 6W\", \n           subtitle=\"From 2014-04-01 onwards \\nMedian = 3.0 days; Mean = 8.5 days; \", \n           caption= \"\\nData source: DSDW ADTCMart; extraction date: 2017-10-11 \") + \n      \n      geom_vline(xintercept = summary.6w[,2], \n                 col=\"red\") + \n      \n      geom_vline(xintercept = summary.6w[,3], \n                 col=\"red\", \n                 linetype=2) + \n      \n      theme_classic(base_size = 16); p4_hist.6w\n\n\n\n# *******************************************\n\n\n\n\n# Save outputs: ---------------\n\npdf(file=\"\\\\\\\\vch.ca/departments/Projects (Dept VC)/Patient Flow Project/Coastal HSDA/2017 Requests/2017.10.10 LGH redevelopment - patient flow between old and new buildings/results/output from src/los-histogram-2015-2017_2.pdf\", \n      height= 8.5, width = 14) \np1_hist.4e\np2_hist.4w\np3_hist.6e\np4_hist.6w\ndev.off()\n\n# single summary table: \nwrite.csv(rbind(summary.4e, \n                summary.4w, \n                summary.6e, \n                summary.6w),\n          file=\"\\\\\\\\vch.ca/departments/Projects (Dept VC)/Patient Flow Project/Coastal HSDA/2017 Requests/2017.10.10 LGH redevelopment - patient flow between old and new buildings/results/output from src/2017-10-11_LGH_summary-of-LOS.csv\", \n          row.names = FALSE)\n\n\n# histogram data, 4E: \nwrite.csv(table.4e, file=\"\\\\\\\\vch.ca/departments/Projects (Dept VC)/Patient Flow Project/Coastal HSDA/2017 Requests/2017.10.10 LGH redevelopment - patient flow between old and new buildings/results/output from src/2017-10-11_LGH_histogram-table_4E.csv\", \n          row.names = FALSE)\n\n# histogram data, 4W: \nwrite.csv(table.4w, file=\"\\\\\\\\vch.ca/departments/Projects (Dept VC)/Patient Flow Project/Coastal HSDA/2017 Requests/2017.10.10 LGH redevelopment - patient flow between old and new buildings/results/output from src/2017-10-11_LGH_histogram-table_4W.csv\", \n          row.names = FALSE)\n\n\n# histogram data, 6E: \nwrite.csv(table.6e, file=\"\\\\\\\\vch.ca/departments/Projects (Dept VC)/Patient Flow Project/Coastal HSDA/2017 Requests/2017.10.10 LGH redevelopment - patient flow between old and new buildings/results/output from src/2017-10-11_LGH_histogram-table_6E.csv\", \n          row.names = FALSE)\n\n# histogram data, 6W: \nwrite.csv(table.6w, file=\"\\\\\\\\vch.ca/departments/Projects (Dept VC)/Patient Flow Project/Coastal HSDA/2017 Requests/2017.10.10 LGH redevelopment - patient flow between old and new buildings/results/output from src/2017-10-11_LGH_histogram-table_6W.csv\", \n          row.names = FALSE)\n",
    "created" : 1508548570310.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3900022994",
    "id" : "DA58D287",
    "lastKnownWriteTime" : 1508809851,
    "last_content_update" : -2147483648,
    "path" : "//vch.ca/departments/Projects (Dept VC)/Patient Flow Project/Coastal HSDA/2017 Requests/2017.10.10 LGH redevelopment - patient flow between old and new buildings/src/2010-10-06_LGH_analysis-of-LOS.R",
    "project_path" : "2010-10-06_LGH_analysis-of-LOS.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}